<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 대시보드</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <header class="main-header">
        <div class="logo">관리자 페이지</div>
        <div class="user-menu">
            <button class="btn btn-secondary"><%= user.username %></button>
            <div class="dropdown-content">
                <a href="#" id="change-password-btn">비밀번호 변경</a>
                <a href="/logout">로그아웃</a>
            </div>
        </div>
    </header>

    <main class="container">
        <section class="card admin-settings">
            <h2>전역 설정</h2>
            <div class="setting-item">
                <label for="auto-register-toggle">참가자 자동 회원가입</label>
                <label class="switch">
                    <input type="checkbox" id="auto-register-toggle" <%= settings.autoRegister ? 'checked' : '' %>>
                    <span class="slider round"></span>
                </label>
            </div>
            <div class="setting-item">
                <label for="beat-range-select">일일 박자 횟수 범위</label>
                <select id="beat-range-select" class="form-input">
                    <% for(let i = 3; i <= 18; i++) { %>
                        <% const range = `${i*10}-${i*10+9}`; %>
                        <option value="<%= range %>" <%= settings.beatRange[0] === i*10 ? 'selected' : '' %>>
                            <%= range %>
                        </option>
                    <% } %>
                </select>
            </div>
        </section>

        <section class="card">
            <h2>참가자 관리 및 기록 조회</h2>
            <div class="history-filter">
                 <label for="history-date">날짜 선택:</label>
                 <input type="date" id="history-date" class="form-input" value="<%= today %>">
            </div>
            <div class="user-list-header">
                <span>사용자</span>
                <span>기록</span>
                <span>관리</span>
            </div>
            <ul id="user-list">
                <% participants.forEach(p => { %>
                    <li class="user-item" data-username="<%= p.username %>">
                        <span class="username"><%= p.username %></span>
                        <span class="history-log" data-username="<%= p.username %>">기록 없음</span>
                        <div class="user-controls">
                            <button class="btn-icon" title="사용자 이름 변경" onclick="adminActions.changeUsername('<%= p.username %>')">✏️</button>
                            <button class="btn-icon" title="비밀번호 변경" onclick="adminActions.changePassword('<%= p.username %>')">🔑</button>
                            <button class="btn-icon" title="참여 기회 추가" onclick="adminActions.grantAttempt('<%= p.username %>')">➕</button>
                            <button class="btn-icon btn-danger" title="사용자 삭제" onclick="adminActions.deleteUser('<%= p.username %>')">🗑️</button>
                            <label class="switch small" title="비밀번호 변경 허용/차단">
                                <input type="checkbox" class="password-lock-toggle" <%= p.canChangePassword ? 'checked' : '' %> onchange="adminActions.togglePasswordLock('<%= p.username %>')">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </li>
                <% }) %>
            </ul>
        </section>
    </main>

    <div id="password-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h3>비밀번호 변경</h3>
            <div class="form-group">
                <label for="current-password">현재 비밀번호</label>
                <input type="password" id="current-password" class="form-input">
            </div>
            <div class="form-group">
                <label for="new-password">새 비밀번호</label>
                <input type="password" id="new-password" class="form-input">
            </div>
            <p id="modal-error" class="error-message"></p>
            <button id="submit-password-change" class="btn btn-primary">변경하기</button>
        </div>
    </div>
    
    <script src="/client.js"></script>
</body>
</html>
